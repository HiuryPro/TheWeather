{% extends "./base.html" %}


{% block title %} The wheather {% endblock %}

{% block content %}


<div class="container">
    <div id="apex"></div>
</div>

{% endblock %}

{% block script %}
<script>
  var teste = {{ latest_regiao_list| safe}} //ignorar erro
  var datasetsUmidade = []
  var datasetsTemperatura = []
  var dataapex = []

  for (var x in teste) {
    var dictU = {}
    var dictT = {}

    var dictxy = {}

    dictT.label = teste[x]['regiao']
    dictU.label = teste[x]['regiao']

    dictxy.name = teste[x]['regiao']
    dictxy.data = []

    var dadosM = teste[x]['dadosM'];

    var dadosTeste = []

    for (var y in dadosM) {
      dictxy.data.push({ x: dadosM[y]['dt_criacao'], y: dadosM[y]['umidade'] })
      dadosTeste.push(dadosM[y]['umidade'])
    }

    dictU.data = dadosM
    dictT.data = dadosM

    dictU.parsing = {
      xAxisKey: 'dt_criacao',
      yAxisKey: 'umidade'
    }

    dictT.parsing = {
      xAxisKey: 'dt_criacao',
      yAxisKey: 'temperatura'
    }

    datasetsUmidade.push(dictU)
    datasetsTemperatura.push(dictT)
    dataapex.push(dictxy)

  }

  var options = {
        series: dataapex,
        chart: {
          type: 'bar',
          height: 350
        },
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '55%',
            endingShape: 'rounded'
          },
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          show: true,
          width: 2,
          colors: ['transparent']
        },
        xaxis: {
          categories: [dadosM[x]['dt_criacao']],
        },
        yaxis: {
          title: {
            text: 'Umidade'
          }
        },
        fill: {
          opacity: 1
        },
        tooltip: {
          y: {
            formatter: function (val) {
              return "Precipitação: " + val + "%"
            }
          }
        }
        };

  var chart = new ApexCharts(document.querySelector("#apex"), options);
  chart.render();

  console.log(dataapex)
</script>

{% endblock %}